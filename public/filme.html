<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Assista online no PipocaFlix" />
  <meta name="theme-color" content="#E50914" />
  <title>PipocaFlix ğŸ¿ â€” Assistindo Filme</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¿</text></svg>" />
  <link rel="stylesheet" href="../assets/css/style.css" />

  <!-- Social Bar Ad -->
  <script src="https://pl28456424.effectivegatecpm.com/af/b2/ae/afb2aeef36a1a40f4d3634823ebf0f59.js" type="text/javascript"></script>
</head>

<body>

  <!-- â”€â”€ NAVBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="navbar" id="navbar">
    <a href="index.html" class="logo">Pipoca<span>Flix</span></a>
    <div class="nav-search">
      <svg viewBox="0 0 24 24"><path d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
      <input type="text" id="navSearchInput" placeholder="Buscar..." autocomplete="off"
        onkeydown="if(event.key==='Enter')window.location='index.html?q='+encodeURIComponent(this.value)" />
    </div>
  </nav>

  <!-- â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="movie-hero" id="movieHero">
    <div class="movie-hero-bg" id="heroBg"></div>
    <div class="movie-hero-overlay"></div>
    <div class="movie-hero-content">
      <div class="movie-poster-wrap">
        <img class="movie-poster" id="moviePoster" src="" alt="Capa do Filme" />
      </div>
      <div class="movie-info">
        <span class="movie-type-badge">ğŸ¬ FILME</span>
        <h1 class="movie-title" id="movieTitle">Carregando...</h1>
        <div class="movie-meta-row" id="movieMeta"></div>
      </div>
    </div>
  </section>

  <!-- â”€â”€ AD BANNER (before player) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="ad-banner">
    <script async data-cfasync="false" src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca"></div>
  </div>

  <!-- â”€â”€ SINOPSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="sinopse-section">
    <p class="sinopse-label">Sinopse</p>
    <p class="sinopse-text" id="movieSinopse">Carregando sinopse...</p>
  </div>

  <!-- â”€â”€ BOTÃƒO DESBLOQUEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="unlock-wrap">
    <div>
      <button class="unlock-btn" id="unlockBtn">
        ğŸ”“ Clique 3 vezes para desbloquear o player
      </button>
      <div class="unlock-steps" style="margin-top: 10px; display: flex; gap: 8px;">
        <div class="unlock-step" id="step1"></div>
        <div class="unlock-step" id="step2"></div>
        <div class="unlock-step" id="step3"></div>
      </div>
    </div>
    <div class="unlock-hint">
      <p>ğŸ”’ Player protegido</p>
      <p>Clique 3x para liberar o streaming</p>
    </div>
  </div>

  <!-- â”€â”€ PLAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="player-section">
    <div class="player-container" id="playerBox" style="display:none;">
      <video
        id="video"
        preload="metadata"
        playsinline
      ></video>

      <!-- Overlay -->
      <div class="player-overlay" id="playerOverlay">
        <div class="player-overlay-text">â–¶ Clique para reproduzir</div>
      </div>

      <!-- Center Play Button -->
      <button id="centerPlay">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </button>

      <!-- Controls -->
      <div class="player-controls hidden" id="playerControls">
        <div class="player-controls-row">
          <button class="control-btn" id="back10" title="Voltar 10s">
            <svg class="icon" viewBox="0 0 24 24"><path d="M11 18V6l-8 6 8 6zm.5-6l8 6V6l-8 6z" opacity=".5"/><path d="M11 18V6l-8 6 8 6z"/><text x="9" y="15" fill="#fff" font-size="5" font-family="Arial">10</text></svg>
          </button>

          <button class="control-btn" id="playPauseBtn" title="Play/Pause">
            <svg class="icon" viewBox="0 0 24 24" id="playIcon">
              <path id="playPausePath" d="M8 5v14l11-7z"/>
            </svg>
          </button>

          <button class="control-btn" id="forward10" title="AvanÃ§ar 10s">
            <svg class="icon" viewBox="0 0 24 24"><path d="M13 6v12l8-6-8-6zm-2 12H3v-2h8zm0-6H5v-2h6z" opacity=".5"/><path d="M13 6v12l8-6-8-6z"/></svg>
          </button>

          <div class="player-title-display" id="playerTitle">PipocaFlix</div>

          <button class="control-btn" id="fullscreenBtn" title="Tela cheia">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M4 4h6v2H6v4H4V4zm14 0v6h-2V6h-4V4h6zm0 14h-6v-2h4v-4h2v6zm-14 0v-6h2v4h4v2H4z"/>
            </svg>
          </button>
        </div>

        <div class="player-progress-row">
          <span class="player-time" id="currentTime">0:00</span>
          <div class="player-progress" id="playerProgress">
            <div class="player-progress-filled" id="playerProgressFill"></div>
          </div>
          <span class="player-time" id="totalTime">0:00</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ AD BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="ad-banner" style="margin-top: 2rem;">
    <script async data-cfasync="false" src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca2"></div>
  </div>

  <!-- â”€â”€ TRAILER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="trailer-section" id="trailerSection" style="display:none;">
    <div class="section-header">
      <h2 class="section-title">Trailer Oficial</h2>
    </div>
    <div class="trailer-embed">
      <iframe id="trailerFrame" src="" title="Trailer Oficial" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen loading="lazy"></iframe>
    </div>
  </section>

  <!-- â”€â”€ ELENCO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="elenco-section" id="elencoSection" style="display:none;">
    <div class="section-header">
      <h2 class="section-title">Elenco Principal</h2>
    </div>
    <div class="actors-row" id="actorsRow"></div>
  </section>

  <!-- â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer class="footer" style="margin-top: 4rem;">
    <div class="footer-logo">PipocaFlix</div>
    <p class="footer-tagline">Seu cinema, sem limites. ğŸ¿</p>
    <div class="footer-links">
      <a href="index.html">â¬… Voltar ao CatÃ¡logo</a>
    </div>
    <p class="footer-copy">Â© 2025 PipocaFlix. Todos os direitos reservados.</p>
  </footer>

  <!-- â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script src="../assets/js/security.js"></script>
  <script src="../assets/js/api.js"></script>
  <script src="../assets/js/player.js"></script>

  <script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  FILME PAGE LOGIC
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Navbar scroll
  window.addEventListener('scroll', () => {
    const nav = document.getElementById('navbar');
    if (window.scrollY > 50) nav.classList.add('scrolled');
    else nav.classList.remove('scrolled');
  }, { passive: true });

  // Extrai ID da URL
  const urlParams = new URLSearchParams(window.location.search);
  const rowId     = urlParams.get('id');

  if (!rowId) {
    window.location.href = 'index.html';
  }

  // â”€â”€â”€ Extrair ID de trailer YouTube â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const extractYoutubeId = (url) => {
    if (!url) return null;
    const patterns = [
      /(?:v=|v\/|embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
      /^([a-zA-Z0-9_-]{11})$/
    ];
    for (const p of patterns) {
      const m = url.match(p);
      if (m) return m[1];
    }
    return url.length === 11 ? url : null;
  };

  // â”€â”€â”€ Renderizar elenco â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const renderCast = (fotosStr, nomesStr) => {
    const section = document.getElementById('elencoSection');
    const row     = document.getElementById('actorsRow');
    if (!fotosStr && !nomesStr) return;

    const fotos = (fotosStr || '').split(',').map(s => s.trim()).filter(Boolean);
    const nomes = (nomesStr || '').split(',').map(s => s.trim()).filter(Boolean);

    if (fotos.length === 0 && nomes.length === 0) return;

    const max = Math.max(fotos.length, nomes.length);
    row.innerHTML = '';

    for (let i = 0; i < max; i++) {
      const foto = fotos[i] || '';
      const nome = nomes[i] || '';
      const div  = document.createElement('div');
      div.className = 'actor-item';
      div.innerHTML = `
        <img class="actor-avatar"
          src="${foto}"
          alt="${nome}"
          onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2272%22 height=%2272%22><circle cx=%2236%22 cy=%2236%22 r=%2236%22 fill=%22%231a1a1a%22/><text fill=%22%23555%22 font-size=%2228%22 x=%2250%%25%22 y=%2255%%25%22 text-anchor=%22middle%22>ğŸ‘¤</text></svg>'"
          loading="lazy"
        />
        <span class="actor-name">${nome}</span>
      `;
      row.appendChild(div);
    }

    section.style.display = 'block';
  };

  // â”€â”€â”€ Carregar filme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const loadFilme = async () => {
    try {
      const data = await API.getConteudoById(rowId);
      if (!data) throw new Error('NÃ£o encontrado');

      // TÃ­tulo
      const nome = data.Nome || 'Sem tÃ­tulo';
      document.title = `${nome} â€” PipocaFlix ğŸ¿`;
      document.getElementById('movieTitle').textContent = nome;
      document.getElementById('playerTitle').textContent = nome;

      // Hero background
      const heroBg = document.getElementById('heroBg');
      if (data.Capa) {
        heroBg.style.backgroundImage = `url('${data.Capa}')`;
        setTimeout(() => heroBg.classList.add('loaded'), 100);
      }

      // Poster
      const poster = document.getElementById('moviePoster');
      if (data.Capa) {
        poster.src = data.Capa;
        poster.alt = nome;
      }

      // Meta info
      const meta = document.getElementById('movieMeta');
      const metaItems = [];
      if (data.Ano)      metaItems.push(`<span class="movie-meta-item">ğŸ“… ${data.Ano}</span>`);
      if (data['DuraÃ§Ã£o']) metaItems.push(`<span class="movie-meta-item">â± ${data['DuraÃ§Ã£o']}</span>`);
      if (data.Categoria) metaItems.push(`<span class="movie-meta-item">ğŸ­ ${data.Categoria}</span>`);
      if (data.Audio)    metaItems.push(`<span class="movie-audio-badge">ğŸ”Š ${data.Audio}</span>`);
      meta.innerHTML = metaItems.join('<span class="movie-meta-sep">â€¢</span>');

      // Sinopse
      document.getElementById('movieSinopse').textContent = data.Sinopse || 'Sinopse nÃ£o disponÃ­vel.';

      // Video source
      const video = document.getElementById('video');
      if (data.Link) {
        video.src = data.Link;
        if (data.Capa) video.poster = data.Capa;
      }

      // Trailer
      const trailerRaw = data.Trailer || '';
      const ytId = extractYoutubeId(trailerRaw);
      if (ytId) {
        const trailerSection = document.getElementById('trailerSection');
        const frame = document.getElementById('trailerFrame');
        frame.src = `https://www.youtube.com/embed/${ytId}?rel=0`;
        trailerSection.style.display = 'block';
      }

      // Elenco
      renderCast(data['Fotos Elenco'], data['Nome Elenco']);

    } catch (err) {
      console.error('[PipocaFlix] Erro ao carregar filme:', err);
      document.getElementById('movieTitle').textContent = 'Erro ao carregar';
      document.getElementById('movieSinopse').textContent = 'NÃ£o foi possÃ­vel carregar os dados do filme.';
    }
  };

  // â”€â”€â”€ Unlock steps visual override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // (O Player.js jÃ¡ gerencia, mas sincronizamos os steps visuais customizados)
  const unlockBtn = document.getElementById('unlockBtn');
  if (unlockBtn) {
    let uc = 0;
    const SMARTLINK = Player.SMARTLINK;
    const steps = [
      document.getElementById('step1'),
      document.getElementById('step2'),
      document.getElementById('step3'),
    ];

    unlockBtn.addEventListener('click', () => {
      window.open(SMARTLINK, '_blank');
      uc++;
      if (steps[uc - 1]) steps[uc - 1].classList.add('done');

      if (uc < 3) {
        unlockBtn.textContent = `ğŸ”“ Clique mais ${3 - uc} vez(es) para desbloquear`;
      } else {
        unlockBtn.textContent = 'âœ… Player Desbloqueado!';
        unlockBtn.disabled = true;
        const pb = document.getElementById('playerBox');
        if (pb) {
          pb.style.display = 'block';
          pb.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    });
  }

  // Remove o handler do player.js para esse botÃ£o (evitar dupla aÃ§Ã£o)
  // (O listener acima substitui)

  loadFilme();
  </script>
</body>
</html>
