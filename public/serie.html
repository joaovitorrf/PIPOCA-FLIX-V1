<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Assista s√©ries online no PipocaFlix" />
  <meta name="theme-color" content="#E50914" />
  <title>PipocaFlix üçø ‚Äî Assistindo S√©rie</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçø</text></svg>" />
  <link rel="stylesheet" href="../assets/css/style.css" />

  <!-- Social Bar Ad -->
  <script src="https://pl28456424.effectivegatecpm.com/af/b2/ae/afb2aeef36a1a40f4d3634823ebf0f59.js" type="text/javascript"></script>
</head>

<body>

  <!-- ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="navbar" id="navbar">
    <a href="index.html" class="logo">Pipoca<span>Flix</span></a>
    <div class="nav-search">
      <svg viewBox="0 0 24 24"><path d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
      <input type="text" id="navSearchInput" placeholder="Buscar..." autocomplete="off"
        onkeydown="if(event.key==='Enter')window.location='index.html?q='+encodeURIComponent(this.value)" />
    </div>
  </nav>

  <!-- ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="movie-hero" id="movieHero">
    <div class="movie-hero-bg" id="heroBg"></div>
    <div class="movie-hero-overlay"></div>
    <div class="movie-hero-content">
      <div class="movie-poster-wrap">
        <img class="movie-poster" id="moviePoster" src="" alt="Capa da S√©rie" />
      </div>
      <div class="movie-info">
        <span class="movie-type-badge">üì∫ S√âRIE</span>
        <h1 class="movie-title" id="movieTitle">Carregando...</h1>
        <div class="movie-meta-row" id="movieMeta"></div>
      </div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ AD BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ad-banner">
    <script async data-cfasync="false" src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca"></div>
  </div>

  <!-- ‚îÄ‚îÄ SINOPSE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sinopse-section">
    <p class="sinopse-label">Sinopse</p>
    <p class="sinopse-text" id="movieSinopse">Carregando sinopse...</p>
  </div>

  <!-- ‚îÄ‚îÄ PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="player-section">
    <div class="player-container" id="playerBox" style="display:none;">
      <video
        id="video"
        preload="metadata"
        playsinline
      ></video>

      <div class="player-overlay" id="playerOverlay">
        <div class="player-overlay-text">‚ñ∂ Clique para reproduzir</div>
      </div>

      <button id="centerPlay">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </button>

      <div class="player-controls hidden" id="playerControls">
        <div class="player-controls-row">
          <button class="control-btn" id="back10" title="Voltar 10s">
            <svg class="icon" viewBox="0 0 24 24"><path d="M11 18V6l-8 6 8 6z"/></svg>
          </button>

          <button class="control-btn" id="playPauseBtn" title="Play/Pause">
            <svg class="icon" viewBox="0 0 24 24">
              <path id="playPausePath" d="M8 5v14l11-7z"/>
            </svg>
          </button>

          <button class="control-btn" id="forward10" title="Avan√ßar 10s">
            <svg class="icon" viewBox="0 0 24 24"><path d="M13 6v12l8-6-8-6z"/></svg>
          </button>

          <div class="player-title-display" id="playerTitle">PipocaFlix</div>

          <button class="control-btn" id="fullscreenBtn" title="Tela cheia">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M4 4h6v2H6v4H4V4zm14 0v6h-2V6h-4V4h6zm0 14h-6v-2h4v-4h2v6zm-14 0v-6h2v4h4v2H4z"/>
            </svg>
          </button>
        </div>

        <div class="player-progress-row">
          <span class="player-time" id="currentTime">0:00</span>
          <div class="player-progress" id="playerProgress">
            <div class="player-progress-filled" id="playerProgressFill"></div>
          </div>
          <span class="player-time" id="totalTime">0:00</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ AD BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ad-banner" style="margin-top: 2rem;">
    <script async data-cfasync="false" src="https://pl28456427.effectivegatecpm.com/cccc7245f0c46289c4b3a2911da39bca/invoke.js"></script>
    <div id="container-cccc7245f0c46289c4b3a2911da39bca2"></div>
  </div>

  <!-- ‚îÄ‚îÄ TEMPORADAS & EPIS√ìDIOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="seasons-section" id="seasonsSection">
    <div class="section-header">
      <h2 class="section-title">Temporadas</h2>
      <span class="section-link" id="epCount"></span>
    </div>

    <!-- Loading state -->
    <div id="seasonsLoading" class="loading-container">
      <div class="spinner"></div>
      <p>Carregando epis√≥dios...</p>
    </div>

    <!-- Tabs temporadas -->
    <div class="seasons-tabs" id="seasonsTabs" style="display:none;"></div>

    <!-- Grid epis√≥dios -->
    <div class="episodes-grid" id="episodesGrid"></div>

    <!-- Empty state epis√≥dios -->
    <div id="seasonsEmpty" style="display:none;" class="empty-state">
      <div class="empty-state-icon">üì≠</div>
      <h3 class="empty-state-title">Epis√≥dios n√£o encontrados</h3>
      <p class="empty-state-sub">Os epis√≥dios desta s√©rie ainda n√£o est√£o dispon√≠veis.</p>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ TRAILER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="trailer-section" id="trailerSection" style="display:none;">
    <div class="section-header">
      <h2 class="section-title">Trailer Oficial</h2>
    </div>
    <div class="trailer-embed">
      <iframe id="trailerFrame" src="" title="Trailer Oficial" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen loading="lazy"></iframe>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ ELENCO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="elenco-section" id="elencoSection" style="display:none;">
    <div class="section-header">
      <h2 class="section-title">Elenco Principal</h2>
    </div>
    <div class="actors-row" id="actorsRow"></div>
  </section>

  <!-- ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <footer class="footer" style="margin-top: 4rem;">
    <div class="footer-logo">PipocaFlix</div>
    <p class="footer-tagline">Seu cinema, sem limites. üçø</p>
    <div class="footer-links">
      <a href="index.html">‚¨Ö Voltar ao Cat√°logo</a>
    </div>
    <p class="footer-copy">¬© 2025 PipocaFlix. Todos os direitos reservados.</p>
  </footer>

  <!-- ‚îÄ‚îÄ SCRIPTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script src="../assets/js/security.js"></script>
  <script src="../assets/js/api.js"></script>
  <script src="../assets/js/player.js"></script>

  <script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  S√âRIE PAGE LOGIC
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const SMARTLINK = 'https://www.effectivegatecpm.com/eacwhk55f?key=87f8fc919fb5d70a825293b5490713dd';

  // Navbar scroll
  window.addEventListener('scroll', () => {
    const nav = document.getElementById('navbar');
    if (window.scrollY > 50) nav.classList.add('scrolled');
    else nav.classList.remove('scrolled');
  }, { passive: true });

  // Extrai ID da URL
  const urlParams = new URLSearchParams(window.location.search);
  const rowId = urlParams.get('id');
  if (!rowId) window.location.href = 'index.html';

  let episodiosGrouped = {};
  let temporadaAtual = 1;
  let serieName = '';

  // ‚îÄ‚îÄ‚îÄ Extrair ID de trailer YouTube ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const extractYoutubeId = (url) => {
    if (!url) return null;
    const m = url.match(/(?:v=|v\/|embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    return m ? m[1] : (url.length === 11 ? url : null);
  };

  // ‚îÄ‚îÄ‚îÄ Renderizar elenco ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const renderCast = (fotosStr, nomesStr) => {
    const section = document.getElementById('elencoSection');
    const row = document.getElementById('actorsRow');
    const fotos = (fotosStr || '').split(',').map(s => s.trim()).filter(Boolean);
    const nomes = (nomesStr || '').split(',').map(s => s.trim()).filter(Boolean);
    const max = Math.max(fotos.length, nomes.length);
    if (max === 0) return;
    row.innerHTML = '';
    for (let i = 0; i < max; i++) {
      const div = document.createElement('div');
      div.className = 'actor-item';
      div.innerHTML = `
        <img class="actor-avatar"
          src="${fotos[i] || ''}"
          alt="${nomes[i] || ''}"
          onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2272%22 height=%2272%22><circle cx=%2236%22 cy=%2236%22 r=%2236%22 fill=%22%231a1a1a%22/><text fill=%22%23555%22 font-size=%2228%22 x=%2250%%25%22 y=%2255%%25%22 text-anchor=%22middle%22>üë§</text></svg>'"
          loading="lazy"
        />
        <span class="actor-name">${nomes[i] || ''}</span>
      `;
      row.appendChild(div);
    }
    section.style.display = 'block';
  };

  // ‚îÄ‚îÄ‚îÄ Tocar epis√≥dio ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const tocarEpisodio = (ep, tempNum) => {
    const { Link, Nome } = ep;
    const epNum = ep.Epis√≥dio || ep['Epis√≥dio'] || '';
    const title = `${serieName} ‚Äî T${tempNum} EP${epNum}`;

    // Abre smartlink
    window.open(SMARTLINK, '_blank');

    const playerBox = document.getElementById('playerBox');
    const video     = document.getElementById('video');
    const overlay   = document.getElementById('playerOverlay');
    const centerPlay = document.getElementById('centerPlay');
    const controls  = document.getElementById('playerControls');
    const playerTitle = document.getElementById('playerTitle');

    playerBox.style.display = 'block';
    video.src = Link || '';
    video.load();
    if (playerTitle) playerTitle.textContent = title;
    if (overlay) overlay.classList.remove('hidden');
    if (centerPlay) centerPlay.style.opacity = '1';
    if (controls) controls.classList.add('hidden');

    playerBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
  };

  // ‚îÄ‚îÄ‚îÄ Mostrar temporada ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const mostrarTemporada = (tempNum) => {
    temporadaAtual = tempNum;

    // Update tabs
    document.querySelectorAll('.season-btn').forEach(btn => {
      btn.classList.toggle('active', parseInt(btn.dataset.temp) === tempNum);
    });

    // Render epis√≥dios
    const grid = document.getElementById('episodesGrid');
    grid.innerHTML = '';
    const eps = episodiosGrouped[tempNum] || [];

    if (eps.length === 0) {
      grid.innerHTML = `<p style="color: var(--white-ghost); font-family: var(--font-ui); padding: 1rem;">Nenhum epis√≥dio encontrado para esta temporada.</p>`;
      return;
    }

    eps.forEach(ep => {
      const epNum = ep.Epis√≥dio || ep['Epis√≥dio'] || '?';
      const epNome = ep.Nome || `Epis√≥dio ${epNum}`;
      const btn = document.createElement('button');
      btn.className = 'episode-btn';
      btn.innerHTML = `
        <span class="ep-num">${epNum}</span>
        <span class="ep-name">${epNome}</span>
        <span class="ep-play-icon">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </span>
      `;
      btn.addEventListener('click', () => tocarEpisodio(ep, temporadaAtual));
      grid.appendChild(btn);
    });
  };

  // ‚îÄ‚îÄ‚îÄ Renderizar temporadas ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const renderSeasons = (grouped) => {
    const tabs = document.getElementById('seasonsTabs');
    const seasons = Object.keys(grouped).sort((a, b) => a - b);

    tabs.innerHTML = '';
    seasons.forEach(tempNum => {
      const btn = document.createElement('button');
      btn.className = 'season-btn';
      btn.dataset.temp = tempNum;
      btn.textContent = `Temporada ${tempNum}`;
      btn.addEventListener('click', () => mostrarTemporada(parseInt(tempNum)));
      tabs.appendChild(btn);
    });

    tabs.style.display = seasons.length > 0 ? 'flex' : 'none';

    // Total epis√≥dios
    const total = Object.values(grouped).reduce((sum, arr) => sum + arr.length, 0);
    document.getElementById('epCount').textContent = `${seasons.length} temporada${seasons.length !== 1 ? 's' : ''} ¬∑ ${total} epis√≥dio${total !== 1 ? 's' : ''}`;

    // Mostrar primeira temporada
    if (seasons.length > 0) {
      mostrarTemporada(parseInt(seasons[0]));
    }
  };

  // ‚îÄ‚îÄ‚îÄ Carregar s√©rie ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const loadSerie = async () => {
    try {
      const data = await API.getConteudoById(rowId);
      if (!data) throw new Error('N√£o encontrado');

      serieName = data.Nome || 'S√©rie';
      document.title = `${serieName} ‚Äî PipocaFlix üçø`;
      document.getElementById('movieTitle').textContent = serieName;
      document.getElementById('playerTitle').textContent = serieName;

      // Hero background
      const heroBg = document.getElementById('heroBg');
      if (data.Capa) {
        heroBg.style.backgroundImage = `url('${data.Capa}')`;
        setTimeout(() => heroBg.classList.add('loaded'), 100);
      }

      // Poster
      const poster = document.getElementById('moviePoster');
      if (data.Capa) {
        poster.src = data.Capa;
        poster.alt = serieName;
      }

      // Meta
      const meta = document.getElementById('movieMeta');
      const metaItems = [];
      if (data.Ano)       metaItems.push(`<span class="movie-meta-item">üìÖ ${data.Ano}</span>`);
      if (data['Dura√ß√£o']) metaItems.push(`<span class="movie-meta-item">‚è± ${data['Dura√ß√£o']}</span>`);
      if (data.Categoria)  metaItems.push(`<span class="movie-meta-item">üé≠ ${data.Categoria}</span>`);
      if (data.Audio)      metaItems.push(`<span class="movie-audio-badge">üîä ${data.Audio}</span>`);
      meta.innerHTML = metaItems.join('<span class="movie-meta-sep">‚Ä¢</span>');

      // Sinopse
      document.getElementById('movieSinopse').textContent = data.Sinopse || 'Sinopse n√£o dispon√≠vel.';

      // Trailer
      const ytId = extractYoutubeId(data.Trailer || '');
      if (ytId) {
        document.getElementById('trailerFrame').src = `https://www.youtube.com/embed/${ytId}?rel=0`;
        document.getElementById('trailerSection').style.display = 'block';
      }

      // Elenco
      renderCast(data['Fotos Elenco'], data['Nome Elenco']);

      // ‚îÄ‚îÄ‚îÄ Carregar epis√≥dios ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      await loadEpisodios(serieName);

    } catch (err) {
      console.error('[PipocaFlix] Erro ao carregar s√©rie:', err);
      document.getElementById('movieTitle').textContent = 'Erro ao carregar';
      document.getElementById('movieSinopse').textContent = 'N√£o foi poss√≠vel carregar os dados da s√©rie.';
      document.getElementById('seasonsLoading').style.display = 'none';
      document.getElementById('seasonsEmpty').style.display = 'flex';
    }
  };

  // ‚îÄ‚îÄ‚îÄ Carregar epis√≥dios da tabela ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const loadEpisodios = async (nomeSerie) => {
    const loading = document.getElementById('seasonsLoading');
    const empty   = document.getElementById('seasonsEmpty');
    const tabs    = document.getElementById('seasonsTabs');

    try {
      // Busca epis√≥dios
      let page = 1;
      let allEps = [];
      let hasMore = true;

      while (hasMore) {
        const BASE_URL = API.BASE_URL;
        const TOKEN    = '1rq7OOnCoVCuSDKXzv8k7JbGh9wO9MsH';
        const TABLE_EP = API.TABLE_EP;

        const encoded = encodeURIComponent(nomeSerie.split(' ').slice(0, 3).join(' '));
        const url = `${BASE_URL}/api/database/rows/table/${TABLE_EP}/?user_field_names=true&size=100&page=${page}`;

        const res = await fetch(url, {
          headers: { Authorization: `Token ${TOKEN}` }
        });
        const json = await res.json();

        if (json.results && json.results.length > 0) {
          // Filtrar epis√≥dios que pertencem a essa s√©rie
          const filtered = json.results.filter(ep => {
            const nome = (ep.Nome || '').toLowerCase();
            const serieNorm = nomeSerie.toLowerCase().slice(0, 15);
            return nome.includes(serieNorm.slice(0, 8)) || true; // Aceita todos por enquanto
          });
          allEps = [...allEps, ...json.results];
        }

        hasMore = json.next !== null && json.next !== undefined;
        page++;
        if (page > 5 || allEps.length >= 500) break;
      }

      loading.style.display = 'none';

      if (allEps.length === 0) {
        empty.style.display = 'flex';
        return;
      }

      // Agrupar por temporada
      episodiosGrouped = API.groupEpisodiosByTemporada(allEps);
      renderSeasons(episodiosGrouped);

    } catch (err) {
      console.error('[PipocaFlix] Erro ao carregar epis√≥dios:', err);
      loading.style.display = 'none';
      empty.style.display = 'flex';
    }
  };

  loadSerie();
  </script>
</body>
</html>
